<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestor Financeiro - Meng√£o</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React e ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  
  <!-- Babel para converter JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .slide-in-right { animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #b91c1c; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #991b1b; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans antialiased">

  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // --- √çcones SVG (Lucide) ---
    const Icon = ({ name, size = 24, className = "" }) => {
      const icons = {
        wallet: <><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4" /><path d="M4 6v12a2 2 0 0 0 2 2h14v-4" /><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z" /></>,
        trendingUp: <><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>,
        trendingDown: <><polyline points="23 18 13.5 8.5 8.5 13.5 1 6" /><polyline points="17 18 23 18 23 12" /></>,
        creditCard: <><rect x="1" y="4" width="22" height="16" rx="2" ry="2" /><line x1="1" y1="10" x2="23" y2="10" /></>,
        pieChart: <><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></>,
        plus: <><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></>,
        home: <><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></>,
        menu: <><line x1="3" y1="12" x2="21" y2="12" /><line x1="3" y1="6" x2="21" y2="6" /><line x1="3" y1="18" x2="21" y2="18" /></>,
        moreHorizontal: <><circle cx="12" cy="12" r="1" /><circle cx="19" cy="12" r="1" /><circle cx="5" cy="12" r="1" /></>,
        x: <><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>,
        trash: <><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /></>,
        chevronLeft: <polyline points="15 18 9 12 15 6" />,
        chevronRight: <polyline points="9 18 15 12 9 6" />,
        alert: <><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></>,
        fileText: <><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" /><polyline points="14 2 14 8 20 8" /><line x1="16" y1="13" x2="8" y2="13" /><line x1="16" y1="17" x2="8" y2="17" /><polyline points="10 9 9 9 8 9" /></>,
        pencil: <><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></>,
        check: <polyline points="20 6 9 17 4 12" />,
        arrowLeft: <><line x1="19" y1="12" x2="5" y2="12" /><polyline points="12 19 5 12 12 5" /></>,
        calendar: <><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></>,
        repeat: <><polyline points="17 1 21 5 17 9" /><path d="M3 11V9a4 4 0 0 1 4-4h14" /><polyline points="7 23 3 19 7 15" /><path d="M21 13v2a4 4 0 0 1-4 4H3" /></>
      };
      return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name] || <circle cx="12" cy="12" r="10" />}</svg>;
    };

    const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

    // --- Novas Categorias Separadas ---
    const incomeCategories = [
      { name: 'Sal√°rio', icon: 'üí∞' },
      { name: 'Freelance', icon: 'üí∏' },
      { name: 'Investimentos', icon: 'üìà' },
      { name: 'Presente', icon: 'üéÅ' },
      { name: 'Reembolso', icon: '‚Ü©Ô∏è' },
      { name: 'Vendas', icon: 'üè∑Ô∏è' },
      { name: 'Outros', icon: 'üì¶' }
    ];

    const expenseCategories = [
      { name: 'Alimenta√ß√£o', icon: 'üçî' },
      { name: 'Transporte', icon: 'üöó' },
      { name: 'Casa', icon: 'üè†' },
      { name: 'Lazer', icon: 'üéâ' },
      { name: 'Sa√∫de', icon: 'üíä' },
      { name: 'Educa√ß√£o', icon: 'üìö' },
      { name: 'Compras', icon: 'üõí' },
      { name: 'Vestu√°rio', icon: 'üëó' },
      { name: 'Viagem', icon: '‚úàÔ∏è' },
      { name: 'Pets', icon: 'üêæ' },
      { name: 'Assinaturas', icon: 'üì∫' },
      { name: 'Banco/Taxas', icon: 'üè¶' },
      { name: 'Outros', icon: 'üì¶' }
    ];

    // Cores do Flamengo (Vermelho predominante)
    const colors = ['#dc2626', '#991b1b', '#000000', '#b91c1c', '#7f1d1d', '#450a0a'];

    // --- Componentes ---
    const ToastContainer = ({ toasts, removeToast }) => (
      <div className="fixed top-4 right-4 z-[60] flex flex-col gap-3 pointer-events-none">
        {toasts.map(toast => (
          <div key={toast.id} className={`pointer-events-auto flex items-center gap-3 px-5 py-4 rounded-xl shadow-xl text-white transform transition-all duration-300 hover:scale-105 slide-in-right ${
            toast.type === 'success' ? 'bg-gradient-to-r from-green-600 to-emerald-700' : 
            toast.type === 'error' ? 'bg-gradient-to-r from-red-600 to-rose-700' : 'bg-gradient-to-r from-red-600 to-black'
          }`}>
            <div className="bg-white/20 p-1.5 rounded-full">
              {toast.type === 'success' && <Icon name="check" size={18} />}
              {toast.type === 'error' && <Icon name="alert" size={18} />}
              {toast.type === 'info' && <Icon name="fileText" size={18} />}
            </div>
            <span className="text-sm font-bold tracking-wide">{toast.message}</span>
            <button onClick={() => removeToast(toast.id)} className="ml-2 opacity-70 hover:opacity-100 hover:bg-white/20 rounded-full p-1 transition-all"><Icon name="x" size={16}/></button>
          </div>
        ))}
      </div>
    );

    const ConfirmDialog = ({ isOpen, title, message, onConfirm, onCancel }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 z-[70] flex items-center justify-center bg-black/30 backdrop-blur-sm fade-in p-4">
          <div className="bg-white rounded-2xl p-6 shadow-2xl w-full max-w-sm transform transition-all scale-100 border border-gray-100">
            <div className="text-center mb-6">
               <div className="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center text-red-600 mx-auto mb-4 shadow-inner"><Icon name="trash" size={32} /></div>
               <h3 className="text-xl font-bold text-gray-800 mb-2">{title}</h3>
               <p className="text-gray-500 leading-relaxed">{message}</p>
            </div>
            <div className="flex gap-3">
              <button onClick={onCancel} className="flex-1 px-4 py-3 rounded-xl border border-gray-200 text-gray-600 font-bold hover:bg-gray-50">Cancelar</button>
              <button onClick={onConfirm} className="flex-1 px-4 py-3 rounded-xl bg-red-600 text-white font-bold hover:bg-red-700 shadow-lg shadow-red-200">Sim, excluir</button>
            </div>
          </div>
        </div>
      );
    };

    function App() {
      const [currentView, setCurrentView] = useState('dashboard');
      const [selectedMonth, setSelectedMonth] = useState(new Date());
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [modalType, setModalType] = useState(null);
      const [editingTransaction, setEditingTransaction] = useState(null);
      const [selectedCard, setSelectedCard] = useState(null);
      const [toasts, setToasts] = useState([]);
      const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: () => {} });

      const initialAccounts = [
        { id: '1', name: 'Carteira', balance: 150.00, type: 'Dinheiro', color: '#dc2626', includeInTotal: true },
        { id: '2', name: 'Santander', balance: 2450.00, type: 'Conta Corrente', color: '#000000', includeInTotal: true }
      ];

      const [accounts, setAccounts] = useState(() => JSON.parse(localStorage.getItem('accounts')) || initialAccounts);
      const [transactions, setTransactions] = useState(() => JSON.parse(localStorage.getItem('transactions')) || []);
      const [cards, setCards] = useState(() => JSON.parse(localStorage.getItem('cards')) || []);
      const [budgets, setBudgets] = useState(() => JSON.parse(localStorage.getItem('budgets')) || []);

      useEffect(() => localStorage.setItem('accounts', JSON.stringify(accounts)), [accounts]);
      useEffect(() => localStorage.setItem('transactions', JSON.stringify(transactions)), [transactions]);
      useEffect(() => localStorage.setItem('cards', JSON.stringify(cards)), [cards]);
      useEffect(() => localStorage.setItem('budgets', JSON.stringify(budgets)), [budgets]);

      const addToast = (message, type = 'success') => {
        const id = Date.now();
        setToasts(prev => [...prev, { id, message, type }]);
        setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
      };
      const removeToast = (id) => setToasts(prev => prev.filter(t => t.id !== id));
      const openConfirm = (title, message, action) => setConfirmModal({ isOpen: true, title, message, onConfirm: () => { action(); setConfirmModal(prev => ({ ...prev, isOpen: false })); }});

      const generalTransactions = useMemo(() => {
        const start = new Date(selectedMonth.getFullYear(), selectedMonth.getMonth(), 1);
        const end = new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1, 0);
        return transactions.filter(t => {
          const tDate = new Date(t.date);
          const tDateAdj = new Date(tDate.valueOf() + tDate.getTimezoneOffset() * 60000);
          return t.type !== 'card_expense' && tDateAdj >= start && tDateAdj <= end;
        }).sort((a, b) => new Date(b.date) - new Date(a.date));
      }, [transactions, selectedMonth]);

      const selectedCardTransactions = useMemo(() => {
        if (!selectedCard) return [];
        return transactions.filter(t => t.type === 'card_expense' && t.cardId === selectedCard.id).sort((a, b) => new Date(b.date) - new Date(a.date));
      }, [transactions, selectedCard]);

      const totalBalance = useMemo(() => accounts.filter(a => a.includeInTotal).reduce((acc, curr) => acc + curr.balance, 0), [accounts]);
      const monthSummary = useMemo(() => {
        let income = 0, expense = 0, cardExpense = 0;
        const start = new Date(selectedMonth.getFullYear(), selectedMonth.getMonth(), 1);
        const end = new Date(selectedMonth.getFullYear(), selectedMonth.getMonth() + 1, 0);
        transactions.filter(t => {
           const tDate = new Date(t.date);
           const tDateAdj = new Date(tDate.valueOf() + tDate.getTimezoneOffset() * 60000);
           return tDateAdj >= start && tDateAdj <= end;
        }).forEach(t => {
          if (t.type === 'income') income += t.amount;
          if (t.type === 'expense') expense += t.amount;
          if (t.type === 'card_expense') cardExpense += t.amount;
        });
        return { income, expense, cardExpense, projectedBalance: totalBalance };
      }, [transactions, selectedMonth, totalBalance]);

      const updateAccountBalance = (accountId, amount) => setAccounts(prev => prev.map(a => a.id === accountId ? { ...a, balance: a.balance + amount } : a));
      const updateCardLimit = (cardId, amount) => setCards(prev => prev.map(c => c.id === cardId ? { ...c, usedLimit: (c.usedLimit || 0) + amount } : c));

      const handleSaveTransaction = (formData) => {
        const { id, amount, description, date, type, category, accountId, cardId, tags, isPaid, recurrenceType, installments, isFixed } = formData;
        const isEditing = !!id;
        
        if (isEditing) {
          const old = transactions.find(t => t.id === id);
          if (old && old.isPaid) {
             if (old.type === 'income') updateAccountBalance(old.accountId, -old.amount);
             else if (old.type === 'expense') updateAccountBalance(old.accountId, old.amount);
             else if (old.type === 'card_expense') updateCardLimit(old.cardId, -old.amount);
          }
          const updated = { ...formData, id };
          setTransactions(prev => prev.map(t => t.id === id ? updated : t));
          if (updated.isPaid) {
             if (updated.type === 'income') updateAccountBalance(updated.accountId, updated.amount);
             else if (updated.type === 'expense') updateAccountBalance(updated.accountId, -updated.amount);
             else if (updated.type === 'card_expense') updateCardLimit(updated.cardId, updated.amount);
          }
          addToast('Transa√ß√£o atualizada!', 'success');
        } else {
          const newTransactions = [];
          const count = (recurrenceType === 'installment' && installments > 1) ? parseInt(installments) : 1;
          const baseDate = new Date(date);
          const perInstallmentAmount = (type === 'card_expense' && count > 1) ? amount / count : amount;

          for (let i = 0; i < count; i++) {
             const tDate = new Date(baseDate);
             tDate.setMonth(baseDate.getMonth() + i);
             const suffix = count > 1 ? ` (${i + 1}/${count})` : '';
             
             newTransactions.push({
                id: Date.now().toString() + i,
                description: description + suffix,
                amount: perInstallmentAmount,
                date: tDate.toISOString().split('T')[0],
                type, category, accountId, cardId, tags, isPaid, 
                isFixed: isFixed || false,
                createdAt: Date.now()
             });
          }

          setTransactions(prev => [...newTransactions, ...prev]);
          
          if (type === 'card_expense') {
             updateCardLimit(cardId, amount);
          } else {
             newTransactions.forEach(t => {
                if (t.isPaid) {
                   if (type === 'income') updateAccountBalance(accountId, t.amount);
                   else updateAccountBalance(accountId, -t.amount);
                }
             });
          }
          addToast(count > 1 ? `${count} lan√ßamentos gerados!` : 'Salvo com sucesso!', 'success');
        }
        setIsModalOpen(false);
        setEditingTransaction(null);
      };

      const handleDeleteTransaction = (id) => {
        openConfirm('Excluir', 'Apagar este lan√ßamento?', () => {
            const t = transactions.find(t => t.id === id);
            if (t && t.isPaid) {
               if (t.type === 'income') updateAccountBalance(t.accountId, -t.amount);
               else if (t.type === 'expense') updateAccountBalance(t.accountId, t.amount);
               else if (t.type === 'card_expense') updateCardLimit(t.cardId, -t.amount);
            }
            setTransactions(prev => prev.filter(t => t.id !== id));
            addToast('Exclu√≠do.', 'success');
        });
      };

      const handlePayInvoice = (amount, accountId, date) => {
         const payment = {
            id: Date.now().toString(),
            description: `Fatura Cart√£o ${selectedCard.name}`,
            amount: amount, date, type: 'expense', category: 'Banco/Taxas', accountId, isPaid: true, tags: ['fatura']
         };
         setTransactions(prev => [payment, ...prev]);
         updateAccountBalance(accountId, -amount);
         updateCardLimit(selectedCard.id, -amount);
         setIsModalOpen(false);
         addToast('Fatura paga!', 'success');
      };

      const handleAddAccount = (data) => { setAccounts(prev => [...prev, { id: Date.now().toString(), ...data }]); setIsModalOpen(false); addToast('Conta criada!', 'success'); };
      const handleAddCard = (data) => { setCards(prev => [...prev, { id: Date.now().toString(), ...data, usedLimit: 0 }]); setIsModalOpen(false); addToast('Cart√£o criado!', 'success'); };
      const handleAddBudget = (data) => { setBudgets(prev => [...prev, { id: Date.now().toString(), ...data }]); setIsModalOpen(false); addToast('Meta definida!', 'success'); };
      const handleDeleteGeneric = (type, id) => { openConfirm('Excluir', 'Tem certeza?', () => { if(type==='account')setAccounts(p=>p.filter(i=>i.id!==id)); if(type==='card')setCards(p=>p.filter(i=>i.id!==id)); if(type==='budget')setBudgets(p=>p.filter(i=>i.id!==id)); addToast('Removido.', 'success'); }); };
      const handleMonthChange = (d) => { const n = new Date(selectedMonth); d==='prev'?n.setMonth(n.getMonth()-1):n.setMonth(n.getMonth()+1); setSelectedMonth(n); };

      // --- Componentes Internos ---
      const Modal = ({ title, children }) => (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 backdrop-blur-sm fade-in">
          <div className="bg-white rounded-2xl w-full max-w-md shadow-2xl max-h-[90vh] overflow-y-auto flex flex-col">
            <div className="p-4 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white z-10">
              <h3 className="text-lg font-bold text-gray-800">{title}</h3>
              <button onClick={() => { setIsModalOpen(false); setEditingTransaction(null); }} className="p-2 hover:bg-gray-100 rounded-full"><Icon name="x" size={20} /></button>
            </div>
            <div className="p-6 space-y-4">{children}</div>
          </div>
        </div>
      );

      const TransactionForm = ({ initialData }) => {
        const [type, setType] = useState(initialData?.type || 'expense');
        const [amount, setAmount] = useState(initialData?.amount || '');
        const [desc, setDesc] = useState(initialData?.description || '');
        const [date, setDate] = useState(initialData?.date || new Date().toISOString().split('T')[0]);
        const [category, setCategory] = useState(initialData?.category || (type === 'income' ? incomeCategories[0].name : expenseCategories[0].name));
        const [accountId, setAccountId] = useState(initialData?.accountId || accounts[0]?.id || '');
        const [cardId, setCardId] = useState(initialData?.cardId || cards[0]?.id || '');
        const [tags, setTags] = useState(initialData?.tags?.join(', ') || '');
        const [isPaid, setIsPaid] = useState(initialData ? initialData.isPaid : true);
        
        const [recurrenceType, setRecurrenceType] = useState('single'); 
        const [installments, setInstallments] = useState('');

        useEffect(() => {
           if (!initialData) {
              setCategory(type === 'income' ? incomeCategories[0].name : expenseCategories[0].name);
           }
        }, [type]);

        const currentCategories = type === 'income' ? incomeCategories : expenseCategories;

        return (
          <form onSubmit={(e) => {
            e.preventDefault();
            handleSaveTransaction({
              id: initialData?.id, amount: parseFloat(amount), description: desc, date, type, category,
              accountId: type !== 'card_expense' ? accountId : undefined,
              cardId: type === 'card_expense' ? cardId : undefined,
              tags: tags.split(',').map(t => t.trim()).filter(Boolean), isPaid,
              recurrenceType, installments, isFixed: recurrenceType === 'fixed'
            });
          }} className="space-y-4">
            <div className="flex p-1 bg-gray-100 rounded-lg">
              <button type="button" onClick={() => setType('income')} className={`flex-1 py-2 rounded-md text-sm font-medium transition-colors ${type === 'income' ? 'bg-white shadow text-green-600' : 'text-gray-500'}`}>Receita</button>
              <button type="button" onClick={() => setType('expense')} className={`flex-1 py-2 rounded-md text-sm font-medium transition-colors ${type === 'expense' ? 'bg-white shadow text-red-600' : 'text-gray-500'}`}>Despesa</button>
              <button type="button" onClick={() => setType('card_expense')} className={`flex-1 py-2 rounded-md text-sm font-medium transition-colors ${type === 'card_expense' ? 'bg-white shadow text-red-700' : 'text-gray-500'}`}>Cart√£o</button>
            </div>
            
            <div className="relative">
              <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">R$</span>
              <input required type="number" step="0.01" value={amount} onChange={e => setAmount(e.target.value)} className="w-full pl-10 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none text-lg font-semibold" placeholder="0,00" />
            </div>

            {!initialData && (
               <div className="grid grid-cols-2 gap-4 bg-gray-50 p-3 rounded-xl">
                  <div className="col-span-2 flex justify-between items-center mb-1">
                     <label className="text-xs font-bold text-gray-500 uppercase flex items-center"><Icon name="repeat" size={12} className="mr-1"/> Repeti√ß√£o</label>
                  </div>
                  <select value={recurrenceType} onChange={e => setRecurrenceType(e.target.value)} className="w-full p-2 bg-white rounded-lg border border-gray-200 text-sm focus:ring-2 focus:ring-red-500 outline-none">
                     <option value="single">√önica</option>
                     <option value="fixed">Fixa (Mensal)</option>
                     <option value="installment">{type === 'card_expense' ? 'Parcelado' : 'Repetir (X vezes)'}</option>
                  </select>
                  {recurrenceType === 'installment' && (
                     <input type="number" placeholder="N¬∫ Vezes" value={installments} onChange={e => setInstallments(e.target.value)} className="w-full p-2 bg-white rounded-lg border border-gray-200 text-sm focus:ring-2 focus:ring-red-500 outline-none" required />
                  )}
                  {recurrenceType === 'installment' && amount && installments > 0 && type === 'card_expense' && (
                     <p className="col-span-2 text-xs text-red-700 font-medium text-center mt-1">
                        Ser√£o {installments}x de {formatCurrency(amount / installments)}
                     </p>
                  )}
               </div>
            )}

            <div className="flex items-center justify-between p-3 bg-gray-50 rounded-xl border border-gray-200">
               <span className="font-medium text-sm text-gray-700">Situa√ß√£o</span>
               <button type="button" onClick={() => setIsPaid(!isPaid)} className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${isPaid ? 'bg-green-600' : 'bg-gray-300'}`}>
                 <span className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${isPaid ? 'translate-x-6' : 'translate-x-1'}`} />
               </button>
            </div>

            <input required type="text" value={desc} onChange={e => setDesc(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none" placeholder="Descri√ß√£o" />
            
            <div className="grid grid-cols-2 gap-4">
              <input required type="date" value={date} onChange={e => setDate(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none" />
              <select value={category} onChange={e => setCategory(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none">
                 {currentCategories.map(c => <option key={c.name} value={c.name}>{c.icon} {c.name}</option>)}
              </select>
            </div>

            {type !== 'card_expense' ? (
              <select value={accountId} onChange={e => setAccountId(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none">{accounts.map(a => <option key={a.id} value={a.id}>{a.name}</option>)}</select>
            ) : (
              <select value={cardId} onChange={e => setCardId(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none">{cards.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}</select>
            )}

            <input type="text" value={tags} onChange={e => setTags(e.target.value)} className="w-full p-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-red-500 outline-none" placeholder="Tags" />
            <button className="w-full bg-red-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-red-200 hover:bg-red-800 transition-transform active:scale-95">{initialData ? 'Atualizar' : 'Salvar'}</button>
          </form>
        );
      };

      const TransactionItem = ({ t }) => (
        <div className="p-4 flex items-center justify-between hover:bg-gray-50 transition-colors group border-b border-gray-50 last:border-0">
          <div className="flex items-center gap-3">
            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${t.isPaid ? 'bg-gray-100 opacity-100' : 'bg-yellow-50 opacity-60'}`}>
              {(t.type === 'income' ? incomeCategories : expenseCategories).find(c => c.name === t.category)?.icon || 'üìÑ'}
            </div>
            <div>
              <div className="flex items-center gap-2">
                 <p className={`font-semibold text-gray-800 ${!t.isPaid && 'text-gray-400'}`}>{t.description}</p>
                 {t.isFixed && <span className="bg-red-100 text-red-800 text-[9px] font-bold px-1.5 py-0.5 rounded uppercase">Fixa</span>}
              </div>
              <p className="text-xs text-gray-500 flex items-center gap-1">
                <span>{new Date(t.date).toLocaleDateString('pt-BR')}</span>
                {t.type === 'card_expense' && <span className="text-red-600 text-[10px] flex items-center"><Icon name="creditCard" size={10} className="mr-0.5"/> Cart√£o</span>}
              </p>
            </div>
          </div>
          <div className="flex items-center gap-4">
            <span className={`font-bold ${!t.isPaid ? 'text-gray-400' : t.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
              {t.type === 'income' ? '+' : '-'}{formatCurrency(t.amount)}
            </span>
            <div className="flex gap-2 md:opacity-0 md:group-hover:opacity-100 transition-opacity">
               <button onClick={(e) => { e.stopPropagation(); setEditingTransaction(t); setModalType('transaction'); setIsModalOpen(true); }} className="text-blue-600 p-1.5"><Icon name="pencil" size={16}/></button>
               <button onClick={(e) => { e.stopPropagation(); handleDeleteTransaction(t.id); }} className="text-red-600 p-1.5"><Icon name="trash" size={16}/></button>
            </div>
          </div>
        </div>
      );

      const PayInvoiceForm = () => {
         const [amount, setAmount] = useState(selectedCard?.usedLimit || 0);
         const [accountId, setAccountId] = useState(accounts[0]?.id || '');
         const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
         return (
            <form onSubmit={(e) => { e.preventDefault(); handlePayInvoice(parseFloat(amount), accountId, date); }} className="space-y-4">
               <div className="bg-red-50 p-4 rounded-xl text-center mb-4">
                  <p className="text-sm text-red-700 font-bold uppercase">Fatura Atual</p>
                  <p className="text-2xl font-bold text-red-900">{formatCurrency(selectedCard?.usedLimit || 0)}</p>
               </div>
               <div><label className="text-xs font-bold text-gray-500 uppercase">Valor</label><input required type="number" step="0.01" value={amount} onChange={e => setAmount(e.target.value)} className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" /></div>
               <div><label className="text-xs font-bold text-gray-500 uppercase">Conta</label><select value={accountId} onChange={e => setAccountId(e.target.value)} className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none">{accounts.map(a => <option key={a.id} value={a.id}>{a.name} ({formatCurrency(a.balance)})</option>)}</select></div>
               <div><label className="text-xs font-bold text-gray-500 uppercase">Data</label><input required type="date" value={date} onChange={e => setDate(e.target.value)} className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" /></div>
               <button className="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg">Confirmar</button>
            </form>
         );
      };

      const Dashboard = () => (
        <div className="space-y-6 fade-in">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="bg-gradient-to-br from-red-700 to-black rounded-2xl p-6 text-white shadow-xl shadow-red-200">
               <p className="text-red-100 text-sm font-medium mb-1">Saldo Atual</p>
               <h2 className="text-3xl font-bold">{formatCurrency(totalBalance)}</h2>
               <div className="mt-4 flex items-center text-xs text-red-200 bg-white/10 w-fit px-2 py-1 rounded-lg backdrop-blur-sm"><Icon name="trendingUp" size={14} className="mr-1" /> Previsto: {formatCurrency(monthSummary.projectedBalance)}</div>
            </div>
            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100"><div className="flex items-center justify-between mb-2"><p className="text-gray-500 text-sm font-medium">Receitas</p><div className="p-2 bg-green-100 text-green-600 rounded-full"><Icon name="trendingUp" size={18}/></div></div><h3 className="text-2xl font-bold text-gray-800">{formatCurrency(monthSummary.income)}</h3></div>
            <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100"><div className="flex items-center justify-between mb-2"><p className="text-gray-500 text-sm font-medium">Despesas</p><div className="p-2 bg-red-100 text-red-600 rounded-full"><Icon name="trendingDown" size={18}/></div></div><h3 className="text-2xl font-bold text-gray-800">{formatCurrency(monthSummary.expense)}</h3></div>
          </div>
          <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
            <div className="p-5 border-b border-gray-100 flex justify-between items-center"><h3 className="text-lg font-bold text-gray-800">Transa√ß√µes Recentes</h3><button onClick={() => setCurrentView('transactions')} className="text-sm text-red-600 font-bold hover:underline">Ver todas</button></div>
            <div>{generalTransactions.slice(0, 5).map(t => <TransactionItem key={t.id} t={t} />)}{generalTransactions.length === 0 && <div className="p-8 text-center text-gray-400">Nenhuma transa√ß√£o geral.</div>}</div>
          </div>
        </div>
      );

      const CardsView = () => {
         if (selectedCard) return (
            <div className="space-y-6 fade-in">
               <button onClick={() => setSelectedCard(null)} className="flex items-center text-gray-500 hover:text-red-700 mb-2 transition-colors"><Icon name="arrowLeft" size={20} className="mr-1"/> Voltar</button>
               <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex flex-col md:flex-row justify-between items-center gap-4">
                  <div><p className="text-gray-500 text-sm uppercase font-bold tracking-wider mb-1">{selectedCard.brand}</p><h2 className="text-3xl font-bold text-gray-800">{selectedCard.name}</h2><p className="text-sm text-gray-400 mt-1">Fecha dia {selectedCard.closingDay} ‚Ä¢ Vence dia {selectedCard.dueDay}</p></div>
                  <div className="text-right bg-red-50 p-4 rounded-xl min-w-[200px]"><p className="text-sm text-red-700 mb-1">Fatura Atual</p><h3 className="text-3xl font-bold text-red-900">{formatCurrency(selectedCard.usedLimit || 0)}</h3><p className="text-xs text-gray-500 mt-1">Limite: {formatCurrency(selectedCard.limit)}</p><button onClick={() => { setModalType('payInvoice'); setIsModalOpen(true); }} className="mt-3 w-full bg-red-700 text-white py-2 rounded-lg text-sm font-bold hover:bg-red-800 shadow-md transition-colors">Pagar Fatura</button></div>
               </div>
               <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                  <div className="p-5 border-b border-gray-100 bg-gray-50"><h3 className="text-lg font-bold text-gray-800">Lan√ßamentos na Fatura</h3></div>
                  <div>{selectedCardTransactions.length > 0 ? selectedCardTransactions.map(t => <TransactionItem key={t.id} t={t} />) : <div className="p-10 text-center text-gray-400">Nenhuma compra.</div>}</div>
               </div>
            </div>
         );
         return (
            <div className="space-y-6 fade-in">
               <div className="flex justify-between items-center"><h2 className="text-2xl font-bold">Cart√µes de Cr√©dito</h2><button onClick={() => { setModalType('card'); setIsModalOpen(true); }} className="bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-800 shadow-lg">+ Novo Cart√£o</button></div>
               <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  {cards.map(card => {
                     const available = card.limit - (card.usedLimit || 0);
                     const progress = Math.min(100, ((card.usedLimit || 0) / card.limit) * 100);
                     return (
                        <div key={card.id} onClick={() => setSelectedCard(card)} className="bg-gradient-to-br from-gray-900 to-black text-white p-6 rounded-2xl shadow-xl relative overflow-hidden cursor-pointer transform transition-transform hover:scale-[1.02] border border-gray-800">
                           <div className="flex justify-between items-start mb-8"><div><p className="text-gray-400 text-sm uppercase">{card.brand}</p><h3 className="font-bold text-xl">{card.name}</h3></div><Icon name="creditCard" className="text-red-600" size={32}/></div>
                           <div className="mb-4"><div className="flex justify-between text-sm mb-2"><span className="text-gray-300">Fatura Atual</span><span className="font-bold text-white">{formatCurrency(card.usedLimit || 0)}</span></div><div className="w-full bg-gray-800 rounded-full h-2"><div className="bg-red-600 h-2 rounded-full" style={{ width: `${progress}%` }}></div></div><div className="flex justify-between text-xs text-gray-400 mt-2"><span>Disp: {formatCurrency(available)}</span><span>Lim: {formatCurrency(card.limit)}</span></div></div>
                           <div className="absolute top-4 right-4 opacity-0 hover:opacity-100"><button onClick={(e) => { e.stopPropagation(); handleDeleteGeneric('card', card.id); }} className="text-gray-500 hover:text-red-500"><Icon name="trash" size={16}/></button></div>
                        </div>
                     );
                  })}
                  {cards.length === 0 && <div className="col-span-full text-center text-gray-500 py-10">Nenhum cart√£o cadastrado.</div>}
               </div>
            </div>
         );
      };

      return (
        <div className="flex min-h-screen bg-gray-50 text-gray-900 font-sans">
          <ToastContainer toasts={toasts} removeToast={removeToast} />
          <ConfirmDialog isOpen={confirmModal.isOpen} title={confirmModal.title} message={confirmModal.message} onConfirm={confirmModal.onConfirm} onCancel={() => setConfirmModal(prev => ({ ...prev, isOpen: false }))} />
          
          <aside className="hidden md:flex w-64 flex-col bg-white border-r border-gray-200 fixed h-full z-20">
            <div className="p-6 flex items-center gap-2 text-red-700"><Icon name="wallet" size={28} /><span className="text-xl font-extrabold tracking-tight text-gray-900">Finan√ßas<span className="text-red-700">Fla</span></span></div>
            <nav className="flex-1 px-4 space-y-2 mt-4">
              {[{ id: 'dashboard', label: 'Vis√£o Geral', icon: 'home' }, { id: 'transactions', label: 'Transa√ß√µes', icon: 'moreHorizontal' }, { id: 'accounts', label: 'Minhas Contas', icon: 'wallet' }, { id: 'cards', label: 'Cart√µes', icon: 'creditCard' }, { id: 'planning', label: 'Planejamento', icon: 'pieChart' }].map(item => (
                <button key={item.id} onClick={() => { setCurrentView(item.id); setSelectedCard(null); }} className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all ${currentView === item.id ? 'bg-red-50 text-red-700 shadow-sm font-bold' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-900'}`}><Icon name={item.icon} size={20} /> {item.label}</button>
              ))}
            </nav>
            <div className="p-4 border-t border-gray-100"><div className="bg-gradient-to-r from-red-700 to-black rounded-xl p-4 text-white text-center shadow-lg shadow-gray-400"><p className="text-xs font-medium opacity-90 mb-2">Saldo Previsto (M√™s)</p><p className="text-xl font-bold">{formatCurrency(monthSummary.projectedBalance)}</p></div></div>
          </aside>

          <main className="flex-1 md:ml-64 pb-24 md:pb-6">
            <header className="bg-white sticky top-0 z-10 border-b border-gray-100 px-4 py-3 flex items-center justify-between md:px-8 md:py-5">
              <div className="flex items-center gap-2 md:hidden text-red-700"><Icon name="wallet" size={24} /><span className="font-bold text-gray-800">Finan√ßas</span></div>
              <div className="flex items-center bg-gray-100 rounded-full p-1 mx-auto md:mx-0">
                <button onClick={() => handleMonthChange('prev')} className="p-1.5 hover:bg-white rounded-full transition-colors text-red-700"><Icon name="chevronLeft" size={16}/></button>
                <span className="px-4 text-sm font-bold capitalize min-w-[100px] text-center text-gray-700">{selectedMonth.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' })}</span>
                <button onClick={() => handleMonthChange('next')} className="p-1.5 hover:bg-white rounded-full transition-colors text-red-700"><Icon name="chevronRight" size={16}/></button>
              </div><div className="w-8 md:w-auto"></div>
            </header>

            <div className="p-4 md:p-8 max-w-5xl mx-auto">
              {currentView === 'dashboard' && <Dashboard />}
              {currentView === 'cards' && <CardsView />}
              {currentView === 'accounts' && (
                <div className="space-y-6 fade-in">
                   <div className="flex justify-between items-center"><h2 className="text-2xl font-bold">Minhas Contas</h2><button onClick={() => { setModalType('account'); setIsModalOpen(true); }} className="bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-800 shadow-lg">+ Nova Conta</button></div>
                   <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                     {accounts.map(acc => (<div key={acc.id} className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 relative overflow-hidden group"><div className="absolute top-0 left-0 w-1.5 h-full" style={{ backgroundColor: acc.color }}></div><h3 className="font-bold text-lg mb-1">{acc.name}</h3><p className="text-sm text-gray-500 mb-4 capitalize">{acc.type}</p><p className="text-2xl font-bold text-gray-800">{formatCurrency(acc.balance)}</p><div className="absolute right-4 top-4 opacity-0 group-hover:opacity-100 transition-opacity"><button onClick={() => handleDeleteGeneric('account', acc.id)} className="p-2 text-red-500 hover:bg-red-50 rounded-full"><Icon name="trash" size={16}/></button></div></div>))}
                   </div>
                </div>
              )}
              {currentView === 'planning' && (
                <div className="space-y-6 fade-in">
                  <div className="flex justify-between items-center"><div><h2 className="text-2xl font-bold">Planejamento</h2><p className="text-sm text-gray-500 mt-1">50% Essenciais ‚Ä¢ 30% Estilo ‚Ä¢ 20% Objetivos</p></div><button onClick={() => { setModalType('budget'); setIsModalOpen(true); }} className="bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-800 shadow-lg">+ Definir Limite</button></div>
                  <div className="grid grid-cols-1 gap-4">{budgets.map(b => (<div key={b.id} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center"><div className="flex items-center gap-3"><div className="bg-gray-100 p-2 rounded-full">{expenseCategories.find(c => c.name === b.category)?.icon || 'üè∑Ô∏è'}</div><div><p className="font-bold text-gray-800">{b.category}</p><p className="text-xs text-gray-500">Teto: {formatCurrency(b.limit)}</p></div></div><button onClick={() => handleDeleteGeneric('budget', b.id)} className="text-red-400 hover:text-red-600"><Icon name="trash" size={18}/></button></div>))}</div>
                </div>
              )}
              {currentView === 'transactions' && (
                <div className="space-y-6 fade-in"><h2 className="text-2xl font-bold">Transa√ß√µes Gerais</h2><div className="bg-white rounded-xl shadow-sm border border-gray-100">{generalTransactions.map(t => <TransactionItem key={t.id} t={t} />)}{generalTransactions.length === 0 && <div className="p-8 text-center text-gray-400">Nenhuma transa√ß√£o geral.</div>}</div></div>
              )}
            </div>
          </main>

          <div className="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-100 flex justify-around py-3 pb-6 px-2 z-40 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
            <button onClick={() => { setCurrentView('dashboard'); setSelectedCard(null); }} className={`flex flex-col items-center gap-1 ${currentView === 'dashboard' ? 'text-red-700 font-bold' : 'text-gray-400'}`}><Icon name="home" size={22} /><span className="text-[10px] font-medium">In√≠cio</span></button>
            <button onClick={() => { setCurrentView('transactions'); setSelectedCard(null); }} className={`flex flex-col items-center gap-1 ${currentView === 'transactions' ? 'text-red-700 font-bold' : 'text-gray-400'}`}><Icon name="moreHorizontal" size={22} /><span className="text-[10px] font-medium">Extrato</span></button>
            <div className="relative -top-8"><button onClick={() => { setModalType('transaction'); setIsModalOpen(true); setEditingTransaction(null); }} className="bg-red-700 text-white p-4 rounded-full shadow-lg shadow-red-200 hover:scale-105 transition-transform"><Icon name="plus" size={28} /></button></div>
            <button onClick={() => { setCurrentView('planning'); setSelectedCard(null); }} className={`flex flex-col items-center gap-1 ${currentView === 'planning' ? 'text-red-700 font-bold' : 'text-gray-400'}`}><Icon name="pieChart" size={22} /><span className="text-[10px] font-medium">Planos</span></button>
            <button onClick={() => { setCurrentView('cards'); setSelectedCard(null); }} className={`flex flex-col items-center gap-1 ${currentView === 'cards' ? 'text-red-700 font-bold' : 'text-gray-400'}`}><Icon name="creditCard" size={22} /><span className="text-[10px] font-medium">Cart√µes</span></button>
          </div>
          
          <div className="hidden md:block fixed bottom-8 right-8"><button onClick={() => { setModalType('transaction'); setIsModalOpen(true); setEditingTransaction(null); }} className="bg-red-700 hover:bg-red-800 text-white p-4 rounded-full shadow-xl shadow-red-300 transition-transform hover:scale-110 flex items-center gap-2 pr-6"><Icon name="plus" size={24} /> <span className="font-bold">Nova Transa√ß√£o</span></button></div>

          {isModalOpen && (
            <Modal title={modalType === 'transaction' ? (editingTransaction ? 'Editar Transa√ß√£o' : 'Nova Transa√ß√£o') : modalType === 'account' ? 'Nova Conta' : modalType === 'card' ? 'Novo Cart√£o' : modalType === 'payInvoice' ? 'Pagar Fatura' : 'Novo Planejamento'}>
              {modalType === 'transaction' && <TransactionForm initialData={editingTransaction} />}
              {modalType === 'payInvoice' && <PayInvoiceForm />}
              {modalType === 'account' && <form onSubmit={(e) => { e.preventDefault(); handleAddAccount({ name: e.target.name.value, balance: parseFloat(e.target.balance.value), type: 'Conta Corrente', color: colors[Math.floor(Math.random() * colors.length)], includeInTotal: true }); }} className="space-y-4"><input name="name" placeholder="Nome da conta" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><input name="balance" type="number" step="0.01" placeholder="Saldo Inicial" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><button className="w-full bg-red-700 text-white py-3 rounded-xl font-bold hover:bg-red-800">Criar Conta</button></form>}
              {modalType === 'card' && <form onSubmit={(e) => { e.preventDefault(); handleAddCard({ name: e.target.name.value, limit: parseFloat(e.target.limit.value), brand: 'Mastercard', closingDay: parseInt(e.target.closing.value), dueDay: parseInt(e.target.due.value) }); }} className="space-y-4"><input name="name" placeholder="Apelido" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><input name="limit" type="number" placeholder="Limite" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><div className="grid grid-cols-2 gap-4"><input name="closing" type="number" placeholder="Fecha dia" max="31" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><input name="due" type="number" placeholder="Vence dia" max="31" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /></div><button className="w-full bg-red-700 text-white py-3 rounded-xl font-bold hover:bg-red-800">Adicionar Cart√£o</button></form>}
              {modalType === 'budget' && <form onSubmit={(e) => { e.preventDefault(); handleAddBudget({ category: e.target.category.value, limit: parseFloat(e.target.limit.value) }); }} className="space-y-4"><label className="block text-sm font-medium text-gray-700">Categoria</label><select name="category" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none">{expenseCategories.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}</select><label className="block text-sm font-medium text-gray-700">Teto (R$)</label><input name="limit" type="number" step="0.01" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-red-500 outline-none" required /><button className="w-full bg-red-700 text-white py-3 rounded-xl font-bold hover:bg-red-800">Definir</button></form>}
            </Modal>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
